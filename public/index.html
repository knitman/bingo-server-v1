<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{
  background:radial-gradient(circle,#ffd000,#ff7a00);
  font-family:Arial;
  text-align:center;
  color:#000;
}

/* ÎœÎµÎ³Î¬Î»Î· Î¼Ï€Î¬Î»Î± 4K */
#number{
  width:400px;
  height:400px;
  border-radius:50%;
  background:white;
  font-size:200px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:20px auto;
  transition: transform 0.3s ease;
}

/* Zoom animation */
#number.zoom {
  transform: scale(1.25);
}

.controls button{
  padding:15px 25px;
  font-size:22px;
  margin:5px;
}

#drawn{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
}

/* ÎœÎ¹ÎºÏÎ­Ï‚ Î¼Ï€Î¬Î»ÎµÏ‚ 4K */
.ball{
  width:90px;
  height:90px;
  border-radius:50%;
  background:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:32px;
}

/* Î‰Ï‡Î¿Ï‚ */
audio { display:none; }
</style>
</head>

<body>

<h1>BINGO ÎšÎ›Î—Î¡Î©Î£Î—</h1>

<!-- ÎœÎµÎ³Î¬Î»Î· Î¼Ï€Î¬Î»Î± -->
<div id="number">â€“</div>

<!-- Î‰Ï‡Î¿Ï‚ -->
<audio id="sound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<div class="controls">
  <button onclick="startAuto()">AUTO</button>
  <button onclick="stopAuto()">STOP</button>
  <button onclick="resetGame()">RESET</button>
</div>

<div id="drawn"></div>

<hr>
<h3>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ¿Ï…Ï€Î¿Î½Î¹Î¿Ï</h3>
<input id="name" placeholder="ÎŒÎ½Î¿Î¼Î±">
<button onclick="createTicket()">QR</button><br>
<canvas id="qr"></canvas>

<script>
let auto = null;

/* === WebSocket === */
const ws = new WebSocket("ws://" + location.host);

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);

  if (data.type === "number") {
    show(data.number, data.drawn);
  }

  if (data.type === "bingo") {
    alert("ğŸ‰ ÎšÎ¬Ï€Î¿Î¹Î¿Ï‚ Ï†ÏÎ½Î±Î¾Îµ BINGO: " + data.name);
  }
};

/* === AUTO DRAW === */
async function autoDraw(){
  const r = await fetch("/api/draw").then(r => r.json());
  if(r.number) show(r.number, r.drawn);
}

function startAuto(){
  fetch("/api/start", { method: "POST" });
  auto = setInterval(autoDraw, 5000);
}

function stopAuto(){
  fetch("/api/stop", { method: "POST" });
  clearInterval(auto);
}

/* === RESET === */
function resetGame(){
  fetch("/api/reset", { method: "POST" });
  document.getElementById("drawn").innerHTML = "";
  document.getElementById("number").innerText = "â€“";
}

/* === UPDATE UI === */
function show(n, arr){
  const num = document.getElementById("number");
  num.innerText = n;

  // Zoom animation
  num.classList.add("zoom");
  setTimeout(() => num.classList.remove("zoom"), 300);

  // Play sound
  document.getElementById("sound").play();

  // Update drawn numbers
  const d = document.getElementById("drawn");
  d.innerHTML = "";
  arr.forEach(x=>{
    const b=document.createElement("div");
    b.className="ball"; 
    b.innerText=x;
    d.appendChild(b);
  });
}

/* === CREATE TICKET === */
async function createTicket(){
  const name = document.getElementById("name").value;

  const r = await fetch("/api/ticket",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name})
  }).then(r=>r.json());

  const link = location.origin + "/ticket.html?ticketId=" + r.ticketId;
  QRCode.toCanvas(document.getElementById("qr"), link);
}
</script>

</body>
</html>
