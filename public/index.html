<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #ffd000, #ff7a00);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  color: white;
}

h1 { margin: 10px 0; }

#winner {
  font-size: 26px;
  font-weight: bold;
  color: #00ff6a;
  margin: 10px 0;
}

#number {
  width: 260px;
  height: 260px;
  border-radius: 50%;
  background: white;
  color: black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 120px;
  font-weight: bold;
  box-shadow: 0 0 30px rgba(0,0,0,0.4);
}

.animate { animation: pop 0.6s ease; }
@keyframes pop {
  0% { transform: scale(0); }
  70% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.controls {
  margin: 20px 0;
  display: flex;
  gap: 15px;
}

button {
  padding: 14px 26px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  background: #222;
  color: white;
  cursor: pointer;
}

button:disabled { opacity: 0.5; }

#drawn {
  margin-top: 20px;
  width: 90%;
  max-width: 900px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.drawn-number {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: white;
  color: black;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ticket-box {
  margin-top: 30px;
  background: rgba(0,0,0,0.25);
  padding: 15px;
  border-radius: 12px;
  text-align: center;
}

.ticket-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
  margin-top: 10px;
}

.cell {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  background: white;
  color: black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
}

.cell.marked {
  background: #ff4444;
  color: white;
}

.bingo-btn {
  margin-top: 15px;
  background: #00c853;
  color: black;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>BINGO ÎšÎ›Î—Î¡Î©Î£Î—</h1>
<div id="winner"></div>

<div id="number">â€“</div>

<div class="controls">
  <button id="manualBtn">MANUAL</button>
  <button id="autoBtn">AUTO</button>
  <button id="stopBtn" disabled>STOP</button>
</div>

<div id="drawn"></div>

<div class="ticket-box">
  <h3>ÎšÎ¿Ï…Ï€ÏŒÎ½Î¹ Î Î±Î¯ÎºÏ„Î·</h3>
  <button id="createTicket">ÎÎ•ÎŸ ÎšÎŸÎ¥Î ÎŸÎÎ™</button>
  <div id="ticketId"></div>

  <div class="ticket-grid" id="ticket"></div>

  <button class="bingo-btn" id="bingoBtn" disabled>ğŸ‰ BINGO!</button>
</div>

<script>
let interval = null;
let running = false;
let currentTicketId = null;

const numberDiv = document.getElementById("number");
const drawnDiv = document.getElementById("drawn");
const manualBtn = document.getElementById("manualBtn");
const autoBtn = document.getElementById("autoBtn");
const stopBtn = document.getElementById("stopBtn");
const ticketDiv = document.getElementById("ticket");
const ticketIdDiv = document.getElementById("ticketId");
const bingoBtn = document.getElementById("bingoBtn");
const winnerDiv = document.getElementById("winner");

// ===== ÎšÎ›Î—Î¡Î©Î£Î— =====
async function drawFromServer() {
  const res = await fetch("/api/draw");
  const data = await res.json();
  if (data.done) {
    stopAuto();
    return;
  }

  numberDiv.textContent = data.number;
  numberDiv.classList.remove("animate");
  void numberDiv.offsetWidth;
  numberDiv.classList.add("animate");

  drawnDiv.innerHTML = "";
  data.drawnNumbers.forEach(n => {
    const d = document.createElement("div");
    d.className = "drawn-number";
    d.textContent = n;
    drawnDiv.appendChild(d);
  });
}

manualBtn.onclick = () => { if (!running) drawFromServer(); };

autoBtn.onclick = () => {
  if (running) return;
  running = true;
  autoBtn.disabled = true;
  manualBtn.disabled = true;
  stopBtn.disabled = false;
  drawFromServer();
  interval = setInterval(drawFromServer, 5000);
};

function stopAuto() {
  running = false;
  clearInterval(interval);
  autoBtn.disabled = false;
  manualBtn.disabled = false;
  stopBtn.disabled = true;
}
stopBtn.onclick = stopAuto;

// ===== ÎšÎŸÎ¥Î ÎŸÎÎ™ =====
document.getElementById("createTicket").onclick = async () => {
  const res = await fetch("/api/ticket", { method: "POST" });
  const data = await res.json();

  currentTicketId = data.ticketId;
  ticketIdDiv.innerHTML = "<b>ID:</b> " + currentTicketId;
  ticketDiv.innerHTML = "";
  bingoBtn.disabled = false;
  winnerDiv.textContent = "";

  data.numbers.forEach(n => {
    const c = document.createElement("div");
    c.className = "cell";
    c.textContent = n;
    c.onclick = () => c.classList.toggle("marked");
    ticketDiv.appendChild(c);
  });
};

// ===== BINGO CHECK =====
bingoBtn.onclick = async () => {
  stopAuto();

  const marked = [...document.querySelectorAll(".cell.marked")]
    .map(c => Number(c.textContent));

  const res = await fetch("/api/check", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      ticketId: currentTicketId,
      marked
    })
  });

  const data = await res.json();

  if (data.win) {
    winnerDiv.textContent = "ğŸ† ÎÎ™ÎšÎ—Î¤Î—Î£ ÎšÎŸÎ¥Î ÎŸÎÎ™: " + currentTicketId;
  } else {
    alert("âŒ Î”ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Bingo Î±ÎºÏŒÎ¼Î±!");
  }
};
</script>

</body>
</html>
