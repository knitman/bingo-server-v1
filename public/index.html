<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{
  background:radial-gradient(circle,#ffd000,#ff7a00);
  font-family:Arial;
  text-align:center;
  color:#000;
}
#number{
  width:260px;height:260px;
  border-radius:50%;
  background:white;
  font-size:120px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:20px auto;
}
.controls button{padding:15px 25px;font-size:18px;margin:5px}
#drawn{display:flex;flex-wrap:wrap;justify-content:center;gap:6px}
.ball{
  width:45px;height:45px;border-radius:50%;
  background:white;display:flex;align-items:center;justify-content:center;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>BINGO ΚΛΗΡΩΣΗ</h1>
<div id="number">–</div>

<div class="controls">
  <button onclick="startAuto()">AUTO</button>
  <button onclick="stopAuto()">STOP</button>
  <button onclick="resetGame()">RESET</button>
</div>

<div id="drawn"></div>

<hr>
<h3>Δημιουργία κουπονιού</h3>
<input id="name" placeholder="Όνομα">
<button onclick="createTicket()">QR</button><br>
<canvas id="qr"></canvas>

<script>
let auto = null;

/* === AUTO DRAW === */
async function autoDraw(){
  const r = await fetch("/api/draw").then(r => r.json());
  if(r.number) show(r.number, r.drawn);
}

function startAuto(){
  fetch("/api/start", { method: "POST" });
  auto = setInterval(autoDraw, 5000);
}

function stopAuto(){
  fetch("/api/stop", { method: "POST" });
  clearInterval(auto);
}

/* === RESET === */
function resetGame(){
  fetch("/api/reset", { method: "POST" });
  document.getElementById("drawn").innerHTML = "";
  document.getElementById("number").innerText = "–";
}

/* === UPDATE UI === */
function show(n, arr){
  document.getElementById("number").innerText = n;
  const d = document.getElementById("drawn");
  d.innerHTML = "";
  arr.forEach(x=>{
    const b=document.createElement("div");
    b.className="ball"; 
    b.innerText=x;
    d.appendChild(b);
  });
}

/* === CREATE TICKET === */
async function createTicket(){
  const name = document.getElementById("name").value;

  const r = await fetch("/api/ticket",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name})
  }).then(r=>r.json());

  const link = location.origin + "/ticket.html?ticketId=" + r.ticketId;
  QRCode.toCanvas(document.getElementById("qr"), link);
}
</script>

</body>
</html>
