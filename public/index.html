<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{
  background:radial-gradient(circle,#ffd000,#ff7a00);
  font-family:Arial;
  text-align:center;
  color:#000;
  margin:0;
  padding:0;
}

/* ÎœÎµÎ³Î¬Î»Î· Î¼Ï€Î¬Î»Î± 4K */
#number{
  width:400px;
  height:400px;
  border-radius:50%;
  background:white;
  font-size:200px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:20px auto;
  transition: transform 0.3s ease;
  box-shadow:0 10px 40px rgba(0,0,0,0.3);
}

/* Zoom animation */
#number.zoom {
  transform: scale(1.25);
}

/* Glass panel */
.controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 25px auto;
  padding: 25px 40px;
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(12px);
  border-radius: 30px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.25);
}

/* Premium curved buttons */
.controls button {
  padding: 18px 36px;
  font-size: 26px;
  margin: 8px;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  font-weight: bold;
  color: white;
  transition: all 0.25s ease;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  gap: 10px;
  position: relative;
  overflow: hidden;
}

/* Ripple effect */
.controls button::after {
  content:"";
  position:absolute;
  width:0;
  height:0;
  background:rgba(255,255,255,0.5);
  border-radius:50%;
  transform:translate(-50%, -50%);
  top:var(--y);
  left:var(--x);
  transition:width 0.4s ease, height 0.4s ease;
}
.controls button:active::after {
  width:200px;
  height:200px;
}

/* Press animation */
.controls button:active {
  transform: scale(0.92);
}

/* AUTO = Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ */
#btnAuto {
  background: linear-gradient(135deg, #00c853, #00e676);
}
#btnAuto:hover {
  transform: scale(1.08);
  box-shadow: 0 8px 22px rgba(0,200,83,0.6);
}

/* STOP = ÎºÏŒÎºÎºÎ¹Î½Î¿ */
#btnStop {
  background: linear-gradient(135deg, #d50000, #ff1744);
}
#btnStop:hover {
  transform: scale(1.08);
  box-shadow: 0 8px 22px rgba(213,0,0,0.6);
}

/* RESET = Î¼Ï€Î»Îµ */
#btnReset {
  background: linear-gradient(135deg, #2962ff, #448aff);
}
#btnReset:hover {
  transform: scale(1.08);
  box-shadow: 0 8px 22px rgba(41,98,255,0.6);
}

/* Drawn numbers */
#drawn{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
}

/* ÎœÎ¹ÎºÏÎ­Ï‚ Î¼Ï€Î¬Î»ÎµÏ‚ 4K */
.ball{
  width:90px;
  height:90px;
  border-radius:50%;
  background:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:32px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

/* Î‰Ï‡Î¿Ï‚ */
audio { display:none; }

/* Î Î¯Î½Î±ÎºÎ±Ï‚ Ï€Î±Î¹ÎºÏ„ÏÎ½ */
#playersContainer{
  max-width:900px;
  margin:20px auto;
  text-align:left;
  background:rgba(255,255,255,0.8);
  padding:15px;
  border-radius:12px;
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
}
#playersContainer h2{
  margin-top:0;
}
#playersTable{
  width:100%;
  border-collapse:collapse;
  font-size:18px;
}
#playersTable th, #playersTable td{
  padding:6px 8px;
  border-bottom:1px solid #ccc;
}
#playersTable th{
  background:#f0f0f0;
}
.winnerRow{
  background:#c8e6c9;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>BINGO ÎšÎ›Î—Î¡Î©Î£Î—</h1>

<div id="number">â€“</div>

<audio id="sound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<div class="controls">
  <button id="btnAuto" onclick="startAuto()">â–¶ï¸ AUTO</button>
  <button id="btnStop" onclick="stopAuto()">â¹ï¸ STOP</button>
  <button id="btnReset" onclick="resetGame()">ğŸ”„ RESET</button>
</div>

<div id="drawn"></div>

<div id="playersContainer">
  <h2>Î ÏÏŒÎ¿Î´Î¿Ï‚ Ï€Î±Î¹ÎºÏ„ÏÎ½</h2>
  <table id="playersTable">
    <thead>
      <tr>
        <th>Î Î±Î¯ÎºÏ„Î·Ï‚</th>
        <th>Î•Ï€Î¹Ï„Ï…Ï‡Î¯ÎµÏ‚</th>
        <th>Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ</th>
        <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
      </tr>
    </thead>
    <tbody id="playersBody"></tbody>
  </table>
</div>

<hr>
<h3>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ¿Ï…Ï€Î¿Î½Î¹Î¿Ï</h3>
<input id="name" placeholder="ÎŒÎ½Î¿Î¼Î±">
<button onclick="createTicket()">QR</button><br>
<canvas id="qr"></canvas>

<script>
let auto = null;

/* Ripple effect handler */
document.querySelectorAll(".controls button").forEach(btn => {
  btn.addEventListener("click", e => {
    const rect = btn.getBoundingClientRect();
    btn.style.setProperty("--x", e.clientX - rect.left + "px");
    btn.style.setProperty("--y", e.clientY - rect.top + "px");
  });
});

/* === WebSocket === */
const wsProtocol = location.protocol === "https:" ? "wss://" : "ws://";
const ws = new WebSocket(wsProtocol + location.host);

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);

  if (data.type === "state") {
    if (data.drawn?.length > 0) {
      const last = data.drawn[data.drawn.length - 1];
      show(last, data.drawn);
    }
    if (data.players) renderPlayers(data.players);
  }

  if (data.type === "number") {
    show(data.number, data.drawn);
    renderPlayers(data.players);
  }

  if (data.type === "players") {
    renderPlayers(data.players);
  }

  if (data.type === "bingo") {
    alert("ğŸ‰ " + data.name + " Ï†ÏÎ½Î±Î¾Îµ BINGO! " + (data.winner ? "ÎˆÎ³ÎºÏ…ÏÎ¿!" : "ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿."));
  }

  if (data.type === "reset") {
    document.getElementById("drawn").innerHTML = "";
    document.getElementById("number").innerText = "â€“";
    renderPlayers([]);
  }
};

/* === AUTO DRAW === */
async function autoDraw(){
  await fetch("/api/draw");
}

function startAuto(){
  fetch("/api/start", { method: "POST" });
  if (auto) clearInterval(auto);
  auto = setInterval(autoDraw, 5000);
}

function stopAuto(){
  fetch("/api/stop", { method: "POST" });
  clearInterval(auto);
}

function resetGame(){
  fetch("/api/reset", { method: "POST" });
}

/* === UPDATE UI === */
function show(n, arr){
  const num = document.getElementById("number");
  num.innerText = n;

  num.classList.add("zoom");
  setTimeout(() => num.classList.remove("zoom"), 300);

  document.getElementById("sound").play();

  const d = document.getElementById("drawn");
  d.innerHTML = "";
  arr.forEach(x=>{
    const b=document.createElement("div");
    b.className="ball"; 
    b.innerText=x;
    d.appendChild(b);
  });
}

/* === Î Î™ÎÎ‘ÎšÎ‘Î£ Î Î‘Î™ÎšÎ¤Î©Î === */
function renderPlayers(players){
  const tbody = document.getElementById("playersBody");
  tbody.innerHTML = "";

  players.forEach(p => {
    const tr = document.createElement("tr");
    if (p.winner) tr.classList.add("winnerRow");

    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${p.hits}/${p.total}</td>
      <td>${p.progress}%</td>
      <td>${p.winner ? "Bingo!" : "Î Î±Î¯Î¶ÎµÎ¹"}</td>
    `;

    tbody.appendChild(tr);
  });
}

/* === CREATE TICKET === */
async function createTicket(){
  const name = document.getElementById("name").value;

  const r = await fetch("/api/ticket",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name})
  }).then(r=>r.json());

  const link = location.origin + "/ticket.html?ticketId=" + r.ticketId;
  QRCode.toCanvas(document.getElementById("qr"), link);
}
</script>

</body>
</html>
